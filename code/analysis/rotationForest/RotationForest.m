classdef RotationForest < ExampleClassifier
    %ROTATION FOREST 
    %
    % Implementation based on https://de.mathworks.com/matlabcentral/...
    % fileexchange/38792-rotation-forest-algorithm
    % 
    % Rotation Forest is an extension of Random Forest,
    % where new samples are generated by bootstrapping the original 
    % training set and transorfming the features with PCA.
    %
    %% Properties
    %    numTrees ..... The number of trees used in the ensemble
    %    treeEnsemble . The ensemble itself, which is a TreeBagger object
    %    splitParameter .... The number of feature subsets
    
    properties
        %number of trees in the ensemble
        numTrees;
        
        %the tree ensemble
        treeEnsemble;
        
        %how many subsets of trainingssets are going to be created
        splitParameter;
        
        %additional specifications possible (eg. predicition of class
        %values as input
    end
    
    methods
        
        function obj = RandomForest(numTrees,splitParameter)
            %specify how many trees should be learned
            obj.numTrees = numTrees;
            obj.splitParameter = splitParameter;
            
        end
        
        function obj = trainOn(obj,trainFeatures,trainLabels)
            [featureList, labelList, ~] = ...
                extractLabeledPixels(trainFeatures, trainLabels);
            if(obj.splitParameter > size(featureList,2))
                error('splitParameter has to be less than the number of features');
            end
            for l=1:obj.numTrees
                %%% obtain the new samples by rotation forest %%%
                K=obj.splitParameter;
                ratio=0.75;
                [R_new,R_coeff]=RotationFal(featureList, labelList, K, ratio);
                %%%% obtain new samples %%%%
                trainRFnew=featureList*R_new;
                testRFnew=[]*R_new;
                
            end
            
            function labels = classifyOn(obj,evalFeatures)
                % Transform input map to vector
                featureList = mapToVec(evalFeatures);
                
                %predict label using the ensemble
                labels = predict(obj.treeEnsemble, featureList);
            end
        end
        
    end
    



